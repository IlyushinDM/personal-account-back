# Серверное приложение "Личный кабинет пациента"

## О проекте

Этот репозиторий содержит исходный код серверной части (бэкенда) для системы "Личный кабинет пациента". Приложение предоставляет RESTful API для взаимодействия с клиентскими приложениями (веб, мобильные).

Бэкенд разработан на языке **Go** с соблюдением принципов чистой архитектуры. Весь стек для разработки полностью инкапсулирован в **Docker**, что обеспечивает быстрый старт и консистентность окружения на любой операционной системе.

## Стек технологий

-   **Язык:** Go 1.24+
-   **Основной фреймворк:** Gin (для маршрутизации и обработки HTTP-запросов)
-   **База данных:** PostgreSQL 15+ (запускается в Docker)
-   **Взаимодействие с БД:** GORM (объектно-реляционное отображение)
-   **Кэширование и сессии:** Redis 7+ (запускается в Docker)
-   **Файловое хранилище:** MinIO (S3-совместимое, запускается в Docker)
-   **Конфигурация:** `cleanenv` (из переменных окружения `.env`)
-   **Логирование:** `logrus` с кастомным форматировщиком.
-   **Миграции БД:** `golang-migrate`
-   **Документация API:** `swag` (генерирует Swagger/OpenAPI 2.0)
-   **Окружение для разработки:** Docker & Docker Compose

## Архитектура

Проект построен на основе слоистой (чистой) архитектуры для разделения ответственности:

-   `cmd/app`: Точка входа в приложение, инициализация всех зависимостей.
-   `internal/config`: Загрузка и управление конфигурацией.
-   `internal/transport/http`: Транспортный уровень (HTTP Handlers). Отвечает за прием запросов, их валидацию и отправку ответов.
-   `internal/services`: Слой бизнес-логики.
-   `internal/repository`: Слой доступа к данным (PostgreSQL, Redis).
-   `internal/storage`: Слой для работы с файловым хранилищем (MinIO).
-   `internal/models`: Структуры данных (сущности, DTO).
-   `migrations/`: SQL-миграции для схемы и тестовых данных.
-   `scripts/`: Вспомогательные скрипты.

## Установка и запуск

### Предварительные требования

1.  **Docker и Docker Compose:** Убедитесь, что у вас установлен [Docker Desktop](https://docs.docker.com/desktop/install/windows-install/). **Это единственная обязательная зависимость.**
2.  **Go:** Установленная версия Go 1.24 или выше (нужен для `swag`).
3.  **Swag:** Утилита для генерации Swagger. Установка: `go install github.com/swaggo/swag/cmd/swag@latest`.

### Быстрый старт

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <your-repository-url>
    cd personal-account-back
    ```

2.  **Создайте файл `.env`:**
    Скопируйте `.env.example` в `.env`. **Никаких изменений вносить не нужно**, все значения по умолчанию уже настроены для работы с Docker Compose.
    ```bash
    cp .env.example .env
    ```

3.  **Запустите все окружение:**
    Откройте терминал (рекомендуется Git Bash или PowerShell) и выполните:
    ```bash
    ./run.sh up
    ```
    Эта команда:
    -   Сгенерирует актуальную документацию Swagger.
    -   Соберет Docker-образ вашего Go-приложения.
    -   Запустит все необходимые сервисы (PostgreSQL, Redis, MinIO) и само приложение.
    -   Автоматически применит миграции к базе данных.

    **Сервер будет доступен по адресу:** `http://localhost:8080`
    **Swagger UI:** `http://localhost:8080/swagger/index.html`
    **MinIO Console:** `http://localhost:9090` (логин/пароль из `.env`)

4.  **(Опционально) Наполните БД тестовыми данными:**
    Откройте **второй терминал** и выполните:
    ```bash
    ./run.sh seed
    ```

### Управление окружением

Для управления окружением используется простой скрипт `run.sh`:

-   `./run.sh up`: **(Основная команда)** Собрать и запустить все сервисы.
-   `./run.sh down`: Остановить и удалить контейнеры.
-   `./run.sh logs`: Показать логи всех запущенных сервисов.
-   `./run.sh logs app`: Показать логи только Go-приложения.
-   `./run.sh seed`: Наполнить базу данных тестовыми данными (выполняется после `up`).
-   `./run.sh swag`: Только перегенерировать документацию Swagger.
-   `./run.sh clean`: Остановить сервисы и **полностью удалить все данные** (базы данных, файлы MinIO).

## API Документация (Swagger)

После успешного запуска (`./run.sh up`), интерактивная документация API будет доступна по адресу:

**[http://localhost:8080/swagger/index.html](http://localhost:8080/swagger/index.html)**

Для обновления документации после внесения изменений в аннотации в коде, просто перезапустите проект командой `./run.sh up` или выполните `make swag`.