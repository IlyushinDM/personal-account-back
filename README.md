# Серверное приложение "Личный кабинет пациента"

## О проекте

Этот репозиторий содержит исходный код серверной части (бэкенда) для системы "Личный кабинет пациента". Приложение предоставляет RESTful API для взаимодействия с клиентскими приложениями (веб, мобильные).

Бэкенд разработан на языке **Go** с соблюдением принципов чистой архитектуры, что обеспечивает хорошую тестируемость, поддержку и расширяемость.

## Стек технологий

- **Язык:** Go 1.24+
- **Основной фреймворк:** Gin (для маршрутизации и обработки HTTP-запросов)
- **База данных:** PostgreSQL 15+
- **Взаимодействие с БД:** GORM (объектно-реляционное отображение)
- **Кэширование и сессии:** Redis (для хранения refresh-токенов и кодов восстановления)
- **Файловое хранилище:** MinIO (S3-совместимое хранилище для аватаров и файлов анализов)
- **Конфигурация:** `cleanenv` (из переменных окружения `.env`)
- **Логирование:** `logrus` с кастомным форматировщиком для структурированных и цветных логов.
- **Миграции БД:** `golang-migrate`
- **Документация API:** `swag` (генерирует Swagger/OpenAPI 2.0)
- **Окружение для разработки:** Docker & Docker Compose

## Архитектура

Проект построен на основе слоистой (чистой) архитектуры для разделения ответственности:

-   `cmd/app`: Точка входа в приложение, инициализация всех зависимостей.
-   `internal/config`: Загрузка и управление конфигурацией.
-   `internal/transport/http`: Транспортный уровень (HTTP Handlers). Отвечает за прием запросов, их валидацию и отправку ответов.
-   `internal/services`: Слой бизнес-логики. Здесь инкапсулирована вся основная логика приложения.
-   `internal/repository`: Слой доступа к данным (DAL). Отвечает за взаимодействие с базами данных (PostgreSQL, Redis).
-   `internal/storage`: Слой для работы с файловым хранилищем (MinIO).
-   `internal/models`: Структуры данных (сущности, DTO).
-   `internal/logger`: Кастомная подсистема логирования.
-   `internal/utils`: Вспомогательные утилиты (хэширование паролей, работа с JWT).
-   `migrations/`: SQL-миграции для схемы и тестовых данных.
-   `scripts/`: Вспомогательные скрипты для управления окружением.

## Установка и запуск

### Предварительные требования

1.  **Docker и Docker Compose:** Убедитесь, что у вас установлен [Docker Desktop](https://docs.docker.com/desktop/install/windows-install/).
2.  **Go:** Установленная версия Go 1.24 или выше.
3.  **Make:** Для удобного запуска команд. В Windows можно установить через [chocolatey](https://chocolatey.org/install): `choco install make`.
4.  **Migrate:** Утилита для миграций. Установка: `go install -tags 'postgres' github.com/golang-migrate/migrate/v4/cmd/migrate@latest`.
5.  **Swag:** Утилита для генерации Swagger-документации. Установка: `go install github.com/swaggo/swag/cmd/swag@latest`.

### Быстрый старт

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <your-repository-url>
    cd personal-account-back
    ```

2.  **Создайте файл `.env`:**
    Скопируйте `.env.example` в `.env` и при необходимости измените значения. Для Docker Compose значения хостов (`postgres`, `redis`, `minio`) менять не нужно.
    ```bash
    cp .env.example .env
    ```

3.  **Запустите все с помощью `make`:**
    Откройте терминал (рекомендуется Git Bash на Windows) и выполните:
    ```bash
    make all
    ```
    Эта команда последовательно выполнит все необходимые шаги: запустит сервисы в Docker, применит миграции, сгенерирует документацию и запустит Go-приложение.

    **Сервер будет доступен по адресу:** `http://localhost:8080`
    **Swagger UI:** `http://localhost:8080/swagger/index.html`

### Управление окружением

Для управления окружением используются простые `make`-команды:

-   `make all`: **(Основная команда)** Запускает все зависимости (PostgreSQL, Redis, MinIO), генерирует Swagger и запускает приложение.
-   `make run`: Запускает только приложение (предполагается, что зависимости уже запущены).
-   `make run-seed`: Запускает все и наполняет базу данных тестовыми данными.
-   `make deps`: Запускает только зависимости (PostgreSQL, Redis, MinIO) в фоновом режиме.
-   `make stop-deps`: Останавливает фоновые процессы зависимостей.
-   `make swag`: Только перегенерировать документацию Swagger.
-   `make clean`: Останавливает все сервисы и удаляет сгенерированные файлы (`/bin`, `/docs`).
-   `make clean-full`: То же, что и `clean`, но также **удаляет все данные** из Docker Volumes (базы данных, файлы MinIO).

## API Документация (Swagger)

После успешного запуска приложения, интерактивная документация API будет доступна по адресу:

**[http://localhost:8080/swagger/index.html](http://localhost:8080/swagger/index.html)**

Документация генерируется автоматически из комментариев в коде (в пакете `internal/transport/http`) с помощью `swag`. Для обновления документации после внесения изменений в аннотации, выполните команду `make swag`.